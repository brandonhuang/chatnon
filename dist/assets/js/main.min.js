function UserMarker(e){this.id=e.id,this.latlng=e.latlng,this.color=e.color,this.setMap(e.map)}function displayMessage(e){if(-1===muteList.indexOf(e.persistentId)){var t=$("#messages").scrollTop()+$("#messages").height(),o=$("#messages")[0].scrollHeight,s="";s=e.name?$('<div class="tag" style="color: '+e.color+';" onclick="muteUser(&quot;'+String(e.persistentId)+'&quot;);"></div>').text(e.name.substr(0,12)):$('<div class="tag" style="color: #ecf0f1;" onclick="muteUser(&quot;'+String(e.persistentId)+'&quot;);"></div>').text("?"),$("#messages").append($('<div class="message" style="background-color: '+e.color+';">').text(e.text).prepend(s)),t>=o-50&&$("#messages").scrollTop($("#messages")[0].scrollHeight)}}function displayUsers(){$("#users-online").text(usersCon)}function displayPageTitle(){$("title").text("Inactive"===windowState?"! Chatnonymous":"Chatnonymous")}function displayUserColor(e){$("#user-color").css("background-color",e)}function displayAllMarkers(e){for(var t=0;t<e.length;t++)displayMarker(e[t])}function displayMarker(e){var t=new google.maps.LatLng(e.latitude,e.longitude),o=new UserMarker({id:e.id,latlng:t,color:e.color,map:map});markers.push(o)}function deleteMarker(e){for(var t=0;t<markers.length;t++)if(markers[t].id==e){markers[t].setMap(null),markers.splice(t,1);break}}function fetchLocation(){navigator.geolocation.getCurrentPosition(geoSuccess)}function geoSuccess(e){position={latitude:Math.round(25*e.coords.latitude)/25,longitude:Math.round(25*e.coords.longitude)/25},socket.emit("position",position)}function userTimeout(){$("#messages").append($('<div class="chat" style="background-color: white; color: #c0392b; padding: 20px 0;">').text("You have been timed out for 60 seconds")),$("#m").addClass("timeout").prop("disabled",!0),setTimeout(function(){$("#m").removeClass("timeout").prop("disabled",!1)},6e4)}function loadName(){if(localStorage.getItem("name")){var e=localStorage.getItem("name");$("#tag").text(e)}}function processMessage(e){var t={text:$("#m").val()};msgRate>3&&userTimeout(),socket.emit("chat message",t),msgRate++,$("#m").val("")}function decrementMsgRate(){setInterval(function(){msgRate>0&&msgRate--},3e3)}function muteUser(e){-1===muteList.indexOf(e)&&confirm("Are you sure you want to mute this user?")&&muteList.push(e)}function initialize(){var e={center:{lat:0,lng:0},zoom:2,disableDefaultUI:!0,zoomControl:!0};map=new google.maps.Map(document.getElementById("map-container"),e),socket.emit("map ready")}UserMarker.prototype=new google.maps.OverlayView,UserMarker.prototype.draw=function(){var e=this,t=this.div;if(!t){t=this.div=document.createElement("div"),t.className="marker",t.style.position="absolute",t.style.background=this.color,google.maps.event.addDomListener(t,"click",function(t){google.maps.event.trigger(e,"click")});var o=this.getPanes();o.overlayImage.appendChild(t)}var s=this.getProjection().fromLatLngToDivPixel(this.latlng);s&&(t.style.left=s.x+"px",t.style.top=s.y+"px")},UserMarker.prototype.remove=function(){this.div&&(this.div.parentNode.removeChild(this.div),this.div=null)},UserMarker.prototype.getPosition=function(){return this.latlng};var socket=io(),windowState,msgRate=0,usersCon=0,muteList=[];$(function(){loadName(),displayPageTitle(),decrementMsgRate(),initialize(),$("form").on("submit",function(e){processMessage(),e.preventDefault()}),$("#tag").on("blur",function(){var e=$(this).text();socket.emit("name",e),localStorage.setItem("name",e)}),$("#tag").on("keypress",function(e){$(this).text().length>=12&&e.preventDefault()}),socket.on("name",function(){var e=$("#tag").text();socket.emit("name",e)}),socket.on("location",function(){fetchLocation()}),socket.on("chat message",function(e){displayMessage(e),displayPageTitle()}),socket.on("chat history",function(e){e.forEach(function(e){displayMessage(e)})}),socket.on("users update",function(e){usersCon=e,displayUsers()}),socket.on("user color",function(e){displayUserColor(e)}),socket.on("add marker",displayMarker),socket.on("delete marker",deleteMarker),socket.on("all markers",displayAllMarkers),$("#mobile-arrow").on("click",function(){$("html, body").animate({scrollTop:"0px"})}),$(window).blur(function(){windowState="Inactive"}),$(window).focus(function(){windowState="Active",displayPageTitle(),$("#m").focus()}),$("#lock").on("click",function(){$(this).toggleClass("unlocked locked"),$(this).toggleClass("icon-lock-open icon-lock")})});var map,markers=[];